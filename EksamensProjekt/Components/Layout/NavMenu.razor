@inject Blazored.LocalStorage.ILocalStorageService LS
@inject NavigationManager Nav
@rendermode InteractiveServer
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<div class="d-flex flex-column vh-100 bg-light shadow-sm p-3" style="width: 220px;">
    <a href="/" class="d-flex align-items-center mb-4 text-dark text-decoration-none">
        <span class="fs-4 fw-bold">Projektstyrings
            System</span>
    </a>

    <nav class="nav nav-pills flex-column mb-auto">
        @if (string.IsNullOrEmpty(username))
        {
            <p>Du er ikke logget ind</p>
            <NavLink class="btn btn-light w-60" href="login">
                <i class="bi bi-box-arrow-right me-2"></i> Login
            </NavLink>

        }
        else if (isAdmin)
        {
            <NavLink class="nav-link text-dark mb-1" href="register" Match="NavLinkMatch.All">
                <i class="bi bi-person-plus-fill me-2"></i> Opret bruger
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="projects">
                <i class="bi bi-folder-fill me-2"></i> Projekter
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="calendar">
                <i class="bi bi-calendar-event-fill me-2"></i> Kalender
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="mytasks">
                <i class="bi bi-list-task me-2"></i> Mine opgaver
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="tasks">
                <i class="bi bi-check-square-fill me-2"></i> Opgaver
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="skills">
                <i class="bi bi-lightning-fill me-2"></i> Skills
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="employees">
                <i class="bi bi-people-fill me-2"></i> Brugere
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="timerecords">
                <i class="bi bi-clock-history me-2"></i> Tidsregistrering
            </NavLink>
        }
        else
        {
            <NavLink class="nav-link text-dark mb-1" href="calendar">
                <i class="bi bi-calendar-event-fill me-2"></i> Kalender
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="mytasks">
                <i class="bi bi-list-task me-2"></i> Mine opgaver
            </NavLink>
            <NavLink class="nav-link text-dark mb-1" href="timerecords">
                <i class="bi bi-clock-history me-2"></i> Tidsregistrering
            </NavLink>
        }

    </nav>

    <hr class="my-3">
    @if (!string.IsNullOrEmpty(username))
    {
        <button class="btn btn-danger w-60" @onclick="Logout">
            <i class="bi bi-box-arrow-right me-2"></i> Logout
        </button>
    }
    <p2>Velkommen @username</p2>
    @if (isAdmin)
    {
        <p2>Logget ind som admin</p2>
    }
</div>


@code {
    private string uname = string.Empty;
    private string username = string.Empty;
    private bool isAdmin;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadUserInfo();
            StateHasChanged(); // opdater UI efter JS interop
        }
    }

    private async Task Logout()
    {
        await LS.ClearAsync();
        Nav.NavigateTo("login", true);
    }

    private async Task LoadUserInfo()
    {
        // Brug private felter, ikke lokal variabel
        uname = await LS.GetItemAsStringAsync("loggedin") ?? string.Empty;
        username = uname.Trim('"');
        
        isAdmin = await LS.GetItemAsync<bool>("isadmin");
    }

}