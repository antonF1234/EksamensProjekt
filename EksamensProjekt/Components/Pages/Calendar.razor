@page "/Calendar"
@using EksamensProjekt.Models
@inject HttpClient Http
@rendermode InteractiveServer
<h3>Opgaver i kalenderen</h3>

<div>
    <button @onclick="PrevMonth">‹</button>
    <span>@currentDate.ToString("MMMM yyyy")</span>
    <button @onclick="NextMonth">›</button>
</div>


<div class="calendar">
    <div class="calendar-header">
        @foreach (var day in Enum.GetValues(typeof(DayOfWeek)))
        {
            <div class="calendar-day-header">@day.ToString().Substring(0,3)</div>
        }
    </div>

    <div class="calendar-body">
        @for (int i = 0; i < (int)new DateTime(currentDate.Year, currentDate.Month, 1).DayOfWeek; i++)
        {
            <div class="calendar-cell empty"></div>
        }

        @for (int day = 1; day <= DateTime.DaysInMonth(currentDate.Year, currentDate.Month); day++)
        {
            var date = new DateTime(currentDate.Year, currentDate.Month, day);
            var dayTasks = tasks.Where(t =>
                t.StartDate?.Date <= date && t.Deadline?.Date >= date).ToList();

            <div class="calendar-cell">
                <div class="date-number">@day</div>
                @foreach(var task in dayTasks)
                {
                    <div class="task">@task.Name</div>
                }
            </div>
        }
    </div>
</div>

@code {
    private List<TaskModel> tasks = new List<TaskModel>();
    private DateTime currentDate = DateTime.Now;

    protected override async Task OnInitializedAsync()
    {
        tasks = await Http.GetFromJsonAsync<List<TaskModel>>("/api/tasks/all");
    }

    private void PrevMonth()
    {
        currentDate = currentDate.AddMonths(-1);
    }

    private void NextMonth()
    {
        currentDate = currentDate.AddMonths(1);
    }
}